# NodeBuildWeb

In a Jenkins server, [create](https://wiki.jenkins-ci.org/display/JENKINS/Building+a+software+project#Buildingasoftwareproject-Settinguptheproject) a new Free Style Project named **NodeBuildWeb**. 

The following sections correspond to the new project, and contain configuration values.

## General

* Project name: NodeBuildWeb

* Description: Clones the repository, builds the Node Web tier code, and uploads a zipped package of the artifacts into an Azure Storage Account.

* GitHub Project URL: `https://github.com/Azure/OpenDev/`

## Source Code Management

* Git

* Repository URL: `https://github.com/Azure/OpenDev.git`

* Branches to Build: Blank or `*/master`

## Build Triggers

To enable automatic builds, check the box next to **GitHub hook trigger for GITScm polling**.

## Build Environment

To start with a fresh environment each time, check the box **Delete workspace before build starts**.

## Build

Execute shell command:

```sh
cd ./node/web

# Restore dependencies
npm install 

echo $BUILD_NUMBER
```

## Post-build Actions

Ensure the [Azure Storage Plugin for Jenkins](https://docs.microsoft.com/en-us/azure/storage/storage-java-jenkins-continuous-integration-solution#how-to-install-the-azure-storage-plugin) is installed and operational.

Create a new Azure Storage Account in a new Resource Group in your Azure subscription. This can either by done via the [Portal](http://portal.azure.com) or via the Azure CLI 2.0 with:

```sh
az group create -n OpenDevJenkinsArtifacts -l WestUS

az storage account create -n opendevjenkinsartifacts -g OpenDevJenkinsArtifacts -l WestUS --sku Standard_LRS
```


### Upload artifacts to Microsoft Azure Blob storage

* Storage Credentials: setup a Jenkins credential for your Azure Storage account by retrieving an account's Key 1 via the [Portal](http://portal.azure.com) or via the Azure CLI 2.0 with:
    
    ```sh
    az storage account keys list -n opendevjenkinsartifacts -g OpenDevJenkinsArtifacts
    ```

* Container Name: match the Jenkins Project name with `NodeBuildWeb`

* List of artifacts to upload: `node/web/**` will ensure all the files built with NPM will be uploaded.

* Click the **Advanced** button within the Upload Artifacts to Microsoft Azure Blob storage section, and enable the following options:

    * Make new container public by default
    * Allow anonymous access for Azure artifact links generated by Jenkins.
    * Upload artifacts only on successful build
    * Upload zipped archive
    * Do not upload individual files

    This will upload a single zip file containing the web tier application code into a publically accessible blob named **archive.zip**
